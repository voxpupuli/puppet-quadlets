<%|
  String[1] $quadlet,
  Boolean $is_user,
  String[1] $dest,
|%>
/bin/bash -c '
    set -euo pipefail;
    d=$(mktemp -d);
    quad=$d/<%= $quadlet %>;
    cp % $quad;
    trap "rm $quad ; rmdir $d" EXIT;
    <%- if $is_user { -%>
    env QUADLET_UNIT_DIRS=$d:<%= $dest %> /usr/lib/systemd/user-generators/podman-user-generator --dryrun
    <%- } else  { -%>
    env QUADLET_UNIT_DIRS=$d:<%= $dest %> /usr/lib/systemd/system-generators/podman-system-generator --dryrun
    <%- } -%>
'
