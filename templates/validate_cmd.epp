<%|
  String[1] $quadlet,
  Boolean $is_user,
  String[1] $dest,
|%>
/bin/bash -c '
    set -euo pipefail;
    d=$(mktemp -d);
    quad=$d/<%= $quadlet %>;
    existing=(<%= $dest %>/*)
    ((${#existing[@]})) && cp -- "${existing[@]}" $d/.
    trap "rm $d/* ; rmdir $d" EXIT;
    cp % $quad;
    env QUADLET_UNIT_DIRS=$d <%= $is_user ? { true => '/usr/lib/systemd/user-generators/podman-user-generator', default => '/usr/lib/systemd/system-generators/podman-system-generator' } %> --dryrun
'
